@page "/Login"

@using LifeHelper.Client.Service

@inject HttpClient httpClient
@inject LIFFService liff
@inject AuthService auth
@inject NavigationManager uriHelper

@code {
    protected override async Task OnInitializedAsync()
    {
        var liffId = await httpClient.GetStringAsync("LIFF/GetLIFFId");
        await liff.InitAsync(liffId);

        if (!await liff.IsLoggedInAsync())
        {
            await liff.LoginAsync();
            return;
        }

        if (!await auth.LoginAsync())
        {
            await liff.LogoutAsync();
            await auth.LogoutAsync();
            uriHelper.NavigateTo("Login", true);
            return;
        }

        uriHelper.NavigateTo("", true);

    }
}
